{% extends "base.html" %}

{% block title %}Create User - VERXID System{% endblock %}

{% block content %}
<div class="space-y-6">
    <!-- Header Section -->
    <div class="bg-white rounded-xl shadow-lg p-6 border-l-4 border-nigeria-green">
        <div class="flex items-center">
            <a href="{{ url_for('manage_users') }}" 
               class="bg-gray-100 text-gray-700 p-3 rounded-lg hover:bg-gray-200 transition-colors duration-200 mr-4">
                <i class="fas fa-arrow-left"></i>
            </a>
            <div>
                <h1 class="text-3xl font-bold text-gray-900 flex items-center">
                    <i class="fas fa-user-plus text-nigeria-green mr-4"></i>
                    Create New User
                </h1>
                <p class="text-gray-600 mt-2">Add a new user to the VERXID system</p>
            </div>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
        <!-- Main Form -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <form method="POST" class="space-y-6">
                    <!-- Basic Information -->
                    <div class="border-b border-gray-200 pb-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-user text-nigeria-green mr-3"></i>
                            Basic Information
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="full_name" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Full Name *
                                </label>
                                <input type="text" 
                                       id="full_name" 
                                       name="full_name" 
                                       required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"
                                       placeholder="Enter full name">
                            </div>
                            <div>
                                <label for="username" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Username *
                                </label>
                                <input type="text" 
                                       id="username" 
                                       name="username" 
                                       required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"
                                       placeholder="Enter username">
                            </div>
                        </div>
                    </div>

                    <!-- Contact Information -->
                    <div class="border-b border-gray-200 pb-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-envelope text-nigeria-green mr-3"></i>
                            Contact Information
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="email" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Email Address *
                                </label>
                                <input type="email" 
                                       id="email" 
                                       name="email" 
                                       required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"
                                       placeholder="Enter email address">
                            </div>
                            <div>
                                <label for="phone" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Phone Number
                                </label>
                                <input type="tel" 
                                       id="phone" 
                                       name="phone"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"
                                       placeholder="Enter phone number">
                            </div>
                        </div>
                    </div>

                    <!-- Security & Role -->
                    <div class="border-b border-gray-200 pb-6">
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-shield-alt text-nigeria-green mr-3"></i>
                            Security & Role
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="password" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Password *
                                </label>
                                <input type="password" 
                                       id="password" 
                                       name="password" 
                                       required
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"
                                       placeholder="Enter password">
                            </div>
                            <div>
                                <label for="role" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Role *
                                </label>
                                <select id="role" 
                                        name="role" 
                                        required
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
                                    <option value="">Select Role</option>
                                    {% if current_user.role == 'super_admin' %}
                                    <option value="super_admin">Super Admin</option>
                                    <option value="state_admin">State Admin</option>
                                    {% endif %}
                                    <option value="algon_focal">ALGON Focal</option>
                                    <option value="dcr_focal">DCR Focal</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Organization & Location -->
                    <div>
                        <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                            <i class="fas fa-building text-nigeria-green mr-3"></i>
                            Organization & Location
                        </h2>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label for="organization" class="block text-sm font-semibold text-gray-700 mb-2">
                                    Organization
                                </label>
                                <input type="text" 
                                       id="organization" 
                                       name="organization"
                                       class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white"
                                       placeholder="e.g., ALGON, NPC">
                            </div>
                            <div>
                                <label for="state_id" class="block text-sm font-semibold text-gray-700 mb-2">
                                    State
                                </label>
                                <select id="state_id" 
                                        name="state_id"
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white">
                                    <option value="">Select State</option>
                                    {% for state in states %}
                                    <option value="{{ state.id }}">{{ state.name }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                            <div class="md:col-span-1">
                                <label for="lga_id" class="block text-sm font-semibold text-gray-700 mb-2">
                                    LGA
                                </label>
                                <select id="lga_id" 
                                        name="lga_id" 
                                        disabled
                                        class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-nigeria-green focus:border-transparent transition-all duration-200 bg-gray-50 focus:bg-white disabled:opacity-50">
                                    <option value="">Select LGA</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end space-x-4 pt-6 border-t border-gray-200">
                        <a href="{{ url_for('manage_users') }}" 
                           class="px-6 py-3 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors duration-200">
                            Cancel
                        </a>
                        <button type="submit" 
                                class="bg-gradient-to-r from-nigeria-green to-accent text-white px-8 py-3 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 flex items-center">
                            <i class="fas fa-user-plus mr-2"></i>Create User
                        </button>
                    </div>
                </form>
            </div>
        </div>
        
        <!-- Role Information Sidebar -->
        <div class="space-y-6">
            <div class="bg-white rounded-xl shadow-lg p-6">
                <h2 class="text-xl font-semibold text-gray-900 mb-4 flex items-center">
                    <i class="fas fa-info-circle text-nigeria-green mr-3"></i>
                    Role Descriptions
                </h2>
                <div class="space-y-4">
                    <div class="p-4 bg-gradient-to-r from-nigeria-green/10 to-nigeria-green/20 rounded-lg border border-nigeria-green/20">
                        <h3 class="font-semibold text-gray-900">Super Admin</h3>
                        <p class="text-sm text-gray-600 mt-1">Full system access across all states and complete administrative control</p>
                    </div>
                    <div class="p-4 bg-gradient-to-r from-blue-50 to-blue-100 rounded-lg border border-blue-200">
                        <h3 class="font-semibold text-gray-900">State Admin</h3>
                        <p class="text-sm text-gray-600 mt-1">Manage users and devices within assigned state boundaries</p>
                    </div>
                    <div class="p-4 bg-gradient-to-r from-nigeria-yellow/20 to-nigeria-yellow/40 rounded-lg border border-nigeria-yellow/30">
                        <h3 class="font-semibold text-gray-900">ALGON Focal</h3>
                        <p class="text-sm text-gray-600 mt-1">Claim and distribute devices at Local Government Area level</p>
                    </div>
                    <div class="p-4 bg-gradient-to-r from-purple-50 to-purple-100 rounded-lg border border-purple-200">
                        <h3 class="font-semibold text-gray-900">DCR Focal</h3>
                        <p class="text-sm text-gray-600 mt-1">Witness device claims and distributions for verification</p>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('state_id').addEventListener('change', function() {
    const stateId = this.value;
    const lgaSelect = document.getElementById('lga_id');
    
    lgaSelect.innerHTML = '<option value="">Select LGA</option>';
    lgaSelect.disabled = !stateId;
    
    if (stateId) {
        fetch(`/api/lgas/${stateId}`)
            .then(response => response.json())
            .then(lgas => {
                lgas.forEach(lga => {
                    const option = document.createElement('option');
                    option.value = lga.id;
                    option.textContent = lga.name;
                    lgaSelect.appendChild(option);
                });
            });
    }
});

document.getElementById('role').addEventListener('change', function() {
    const role = this.value;
    const orgField = document.getElementById('organization');
    
    if (role === 'algon_focal') {
        orgField.value = 'ALGON';
    } else if (role === 'dcr_focal') {
        orgField.value = 'NPC';
    }
});
</script>
{% endblock %}